<head>
    <meta charset="UTF-8">
    <title>Djey</title>
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/jquery-ui-1.9.2.custom.min.css">
    <link rel="icon" sizes="64x64" href="favico.ico?v=3">
</head>

<body>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>(adsbygoogle = window.adsbygoogle || []).push({ google_ad_client: "ca-pub-2092301732899176", enable_page_level_ads: true }); </script>
{{>sAlert}}
{{>envStatus}}
</body>

<template name="AppLayout">
    <div id="globalWrap">
        <div class="content">
            <div id="logo">
                <span>
                    {{#with name}}
                        {{.}}
                    {{else}}
                        VainGlory турнир от Djey
                    {{/with}}
                    {{#if is_admin}}
                        <button id="newTour">Новый турнир</button>
                    {{/if}}
                </span>
            </div>
            {{>yield}}
        </div>
        <div id="footer">
            <div><a href="https://vk.com/djeyclub" target="_blank">VK Vainglory с Djey</a></div>
            <div><a href="http://www.youtube.com/c/djeyTV" target="_blank">Youtube DjeyTV</a></div>
            <div><a href="https://www.twitch.tv/djey2828" target="_blank">Twitch Djey2828</a></div>
            <div><a href="https://goodgame.ru/channel/djey2828" target="_blank">GoodGame Djey2828</a></div>
            <div><a href="https://discord.gg/h7DNGhV" target="_blank">Discord Djey</a></div>
        </div>
    </div>
    {{>setPlayer}}
</template>

<template name="envStatus">
    {{#with status}}
        {{#if eq status '-1'}}
            {{>dbd}}
        {{else}}
            <div id="envStatus">
                {{{.}}}
            </div>
        {{/if}}
    {{/with}}
</template>

<template name="setPlayer">
    <div class="ui-helper-hidden" id="setPlayer-dialog" title="Принять участие">
        <br>
        <label for="name">Ник в игре VainGlory</label>
        <br><br>
        <input type="text" id="setPlayer-name" value="" class="text ui-widget-content ui-corner-all">
        <input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
    </div>
</template>

<template name="index">
    {{error}}
    <div id="wrap">
        <div id="mainBlock" class="row">
            <div id="commandTable">
                {{#each tour in tour_list}}
                    <div class="tour">
                        {{#each match in tour}}
                            <div class="match">
                                {{#if is_admin}}
                                    <button data-tour="{{match.tour}}" data-match="{{match.match}}" class="draft">D</button>
                                {{/if}}
                                <div class="inline">
                                    <div class="command">
                                        {{#if match.commands.[0]}}
                                            <span>
                                                <div class="online {{command_status match.commands.[0]}}"></div>
                                                {{com_name match.commands.[0]}}
                                            </span>
                                            {{#if is_admin}}
                                                {{#if eq match.status 0}}
                                                    {{#if eq match.commands.length 2}}
                                                        <button class="commandIsWin"
                                                                data-commands="{{match.commands}}"
                                                                data-tour="{{match.tour}}"
                                                                data-match="{{match.match}}"
                                                                data-win="{{match.commands.[0]}}">W
                                                        </button>
                                                    {{/if}}
                                                {{/if}}
                                            {{/if}}
                                        {{/if}}
                                    </div>
                                    <div class="command">
                                        {{#if match.commands.[1]}}
                                            <span>
                                                <div class="online {{command_status match.commands.[1]}}"></div>
                                                {{com_name match.commands.[1]}}
                                            </span>
                                            {{#if is_admin}}
                                                {{#if eq match.status 0}}
                                                    {{#if eq match.commands.length 2}}
                                                        <button class="commandIsWin"
                                                                data-commands="{{match.commands}}"
                                                                data-tour="{{match.tour}}"
                                                                data-match="{{match.match}}"
                                                                data-win="{{match.commands.[1]}}">W
                                                        </button>
                                                    {{/if}}
                                                {{/if}}
                                            {{/if}}
                                        {{/if}}
                                    </div>
                                </div>
                            </div>
                        {{/each}}
                    </div>
                {{/each}}
            </div>
            <div id="conList">
                {{#if is_player}}
                    <button id="unsetPlayer">Отказаться от участия</button>
                {{else}}
                    <button id="setPlayer">Принять участие</button>
                {{/if}}
                <ul data-key="0" class="connectedSortable">
                    {{#each con_list}}{{>liPlayer}}{{/each}}
                </ul>
                {{#with stats}}
                    <div id="statInfo">
                        <p>Онлайн пользователей: {{all}}</p>
                        <p>Участников: {{player}}</p>
                    </div>
                {{/with}}
            </div>
        </div>
        <ul id="commandList" class="row">
            {{#each command_list}}
                <li class="commandItem connectedSortable">
                    <p class="addRondomTo" data-key="{{.}}">
                        {{com_name .}}
                        {{#if is_admin}}<span class="edit">&#9998;</span>{{/if}}
                    </p>
                    <ul data-key="{{.}}" id="commandItem{{.}}" class="connectedSortable">
                        {{#each command_player .}}
                            {{>liPlayer}}
                        {{/each}}
                    </ul>
                </li>
            {{/each}}
        </ul>
        <ul id="lastList" class="row">
            {{#each last_list}}
                <li>
                    {{#if is_admin}}
                    <div data-name="{{name}}" class="remove">&#8635;</div>
                    {{/if}}
                    {{name}} ({{vg_level}})
                </li>
            {{/each}}
        </ul>
    </div>
</template>

<template name="liPlayer">
    <li data-id="{{_id}}">
        <div class="online {{#unless online}}offline{{/unless}}"></div>{{name}} ({{vg_level}})
    </li>
</template>

<template name="signin">
    <div id="wrap">
        <div id="mainBlock" class="row">
            <input type="password" id="authPassword">
            <button id="authSend">Auth</button>
        </div>
    </div>
</template>

<template name="dbd">
    <div id="dbd">
        {{#if is_admin}}
            <button id="closeDBD">Закрыть драфт</button>
        {{/if}}
        <div class="wrap">
            <div class="block-action teamA">
                {{#with teamList 'A'}}
                    <div class="players">
                        {{#each .}}
                            <p class="{{#if isCurrent}}current{{/if}}"><div class="online {{#unless online}}offline{{/unless}}"></div>{{name}} ({{vg_level}})</p>
                        {{/each}}
                    </div>
                {{/with}}
                <div id="action-step0" class="ban" style="{{styleStep 0}}"></div>
                <div id="action-step2" class="pick" style="{{styleStep 2}}"></div>
                <div id="action-step5" class="ban" style="{{styleStep 5}}"></div>
                <div id="action-step7" class="pick" style="{{styleStep 7}}"></div>
                <div id="action-step8" class="pick" style="{{styleStep 8}}"></div>
            </div>

            <div id="heroesIcons">
                {{#each heroes}}
                    <div class="{{class}}" data-name="{{name}}"
                         style="background-image: url('/img/{{name}}.gif')"></div>{{/each}}
            </div>

            <div class="block-action teamB">
                {{#with teamList 'B'}}
                    <div class="players">
                        {{#each .}}
                            <p class="{{#if isCurrent}}current{{/if}}"><div class="online {{#unless online}}offline{{/unless}}"></div>{{name}} ({{vg_level}})</p>
                        {{/each}}
                    </div>
                {{/with}}
                <div id="action-step1" class="ban" style="{{styleStep 1}}"></div>
                <div id="action-step3" class="pick" style="{{styleStep 3}}"></div>
                <div id="action-step4" class="ban" style="{{styleStep 4}}"></div>
                <div id="action-step6" class="pick" style="{{styleStep 6}}"></div>
                <div id="action-step9" class="pick" style="{{styleStep 9}}"></div>
            </div>
        </div>
    </div>
</template>